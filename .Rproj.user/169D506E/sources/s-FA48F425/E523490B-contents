rm(list=ls()) #clears workspace 
Bleaching.fragments <- read.csv('~/MyProjects/Acclim_Dynamics/Physiology_variables/Bleaching_ImageJ_QC.csv', header=T, sep=",")
  Bleaching.fragments$PLUG.ID <- as.factor(Bleaching.fragments$PLUG.ID)
Coral.survivorship <- read.csv('~/MyProjects/Acclim_Dynamics/Physiology_variables/coral_survivorship.csv', header=T, sep=",")
  Coral.survivorship$PLUG.ID <- as.factor(Coral.survivorship$PLUG.ID)
Master.fragment <- read.csv('~/MyProjects/Acclim_Dynamics/Environmental_data/Master_Fragment_20200616.csv', header=T, sep=",")
  Master.fragment$PLUG.ID <- as.factor(Master.fragment$PLUG.ID)
Buoyant.weight <- read.csv('~/MyProjects/Acclim_Dynamics/Physiology_variables/Growth_Buoyant_Weight/Buoyant_Weight.csv', header=T, sep=",")
  Buoyant.weight$PLUG.ID <- as.factor(Buoyant.weight$PLUG.ID)

library(dplyr)

## Prior to R script, survivorship and master spreadsheet were directly compared

#### Comparing survivorship datasheet to bleaching fragment datasheet to check if the fragments are alive when they are supposed to be
## Week 1: 20180926; Day 5
Week1_IDs <- subset(Bleaching.fragments, Timepoint=="Week1") %>% select(PLUG.ID)
Day5_IDs <- subset(Coral.survivorship, Day.5=="alive") %>% select(PLUG.ID)

# checking for duplicate Plug.IDs in Week 1's subset of Bleaching Score dataset
  wk1_occur <- data.frame(table(Week1_IDs$PLUG.ID))
  wk1_occur[wk1_occur$Freq > 1,] # prints the coral IDs that occured more than once

# rows that appear in bleaching spreadsheet (Week1_IDs) but not in survivorship as "alive" on Day 5 (Day5_IDs)
  ## dplyr::setdiff(y, z)  : rows that appear in y but not in z
# output is the corals that have a bleaching score data point but were not alive on that day 
Week1_mismatched <- setdiff(Week1_IDs, Day5_IDs) 
Week1_mismatched

## Week 2: 20181003; Day 12
Week2_IDs <- subset(Bleaching.fragments, Timepoint=="Week2") %>% select(PLUG.ID)
Day12_IDs <- subset(Coral.survivorship, Day.12=="alive") %>% select(PLUG.ID)
wk2_occur <- data.frame(table(Week2_IDs$PLUG.ID))
wk2_occur[wk2_occur$Freq > 1,] ## duplicates in blch score
Week2_mismatched <- setdiff(Week2_IDs, Day12_IDs) 
Week2_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 3: 20181011; Day 20
Week3_IDs <- subset(Bleaching.fragments, Timepoint=="Week3") %>% select(PLUG.ID)
Day20_IDs <- subset(Coral.survivorship, Day.20=="alive") %>% select(PLUG.ID)
wk3_occur <- data.frame(table(Week3_IDs$PLUG.ID))
wk3_occur[wk3_occur$Freq > 1,] ## duplicates in blch score
Week3_mismatched <- setdiff(Week3_IDs, Day20_IDs) 
Week3_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 4: 20181018; Day 27
Week4_IDs <- subset(Bleaching.fragments, Timepoint=="Week4") %>% select(PLUG.ID)
Day27_IDs <- subset(Coral.survivorship, Day.27=="alive") %>% select(PLUG.ID)
wk4_occur <- data.frame(table(Week4_IDs$PLUG.ID))
wk4_occur[wk4_occur$Freq > 1,] ## duplicates in blch score
Week4_mismatched <- setdiff(Week4_IDs, Day27_IDs) 
Week4_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 5: 20181025; Day 34
Week5_IDs <- subset(Bleaching.fragments, Timepoint=="Week5") %>% select(PLUG.ID)
Day34_IDs <- subset(Coral.survivorship, Day.34=="alive") %>% select(PLUG.ID)
wk5_occur <- data.frame(table(Week5_IDs$PLUG.ID))
wk5_occur[wk5_occur$Freq > 1,] ## duplicates in blch score
Week5_mismatched <- setdiff(Week5_IDs, Day34_IDs) 
Week5_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 6: 20181102; Day 42
Week6_IDs <- subset(Bleaching.fragments, Timepoint=="Week6") %>% select(PLUG.ID)
Day42_IDs <- subset(Coral.survivorship, Day.42=="alive") %>% select(PLUG.ID)
wk6_occur <- data.frame(table(Week6_IDs$PLUG.ID))
wk6_occur[wk6_occur$Freq > 1,] ## duplicates in blch score
Week6_mismatched <- setdiff(Week6_IDs, Day42_IDs) 
Week6_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 7: 20181109; Day 49
Week7_IDs <- subset(Bleaching.fragments, Timepoint=="Week7") %>% select(PLUG.ID)
Day49_IDs <- subset(Coral.survivorship, Day.49=="alive") %>% select(PLUG.ID)
wk7_occur <- data.frame(table(Week7_IDs$PLUG.ID))
wk7_occur[wk7_occur$Freq > 1,] ## duplicates in blch score
Week7_mismatched <- setdiff(Week7_IDs, Day49_IDs) 
Week7_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 8: 20181116; Day 56
Week8_IDs <- subset(Bleaching.fragments, Timepoint=="Week8") %>% select(PLUG.ID)
Day56_IDs <- subset(Coral.survivorship, Day.56=="alive") %>% select(PLUG.ID)
wk8_occur <- data.frame(table(Week8_IDs$PLUG.ID))
wk8_occur[wk8_occur$Freq > 1,] ## duplicates in blch score
Week8_mismatched <- setdiff(Week8_IDs, Day56_IDs) 
Week8_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 9: 20181123; Day 63
Week9_IDs <- subset(Bleaching.fragments, Timepoint=="Week9") %>% select(PLUG.ID)
Day63_IDs <- subset(Coral.survivorship, Day.63=="alive") %>% select(PLUG.ID)
wk9_occur <- data.frame(table(Week9_IDs$PLUG.ID))
wk9_occur[wk9_occur$Freq > 1,] ## duplicates in blch score
Week9_mismatched <- setdiff(Week9_IDs, Day63_IDs) 
Week9_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 10: 20181130; Day 70
Week10_IDs <- subset(Bleaching.fragments, Timepoint=="Week10") %>% select(PLUG.ID)
Day70_IDs <- subset(Coral.survivorship, Day.70=="alive") %>% select(PLUG.ID)
wk10_occur <- data.frame(table(Week10_IDs$PLUG.ID))
wk10_occur[wk10_occur$Freq > 1,] ## duplicates in blch score
Week10_mismatched <- setdiff(Week10_IDs, Day70_IDs) 
Week10_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 11: 20181207; Day 77
Week11_IDs <- subset(Bleaching.fragments, Timepoint=="Week11") %>% select(PLUG.ID)
Day77_IDs <- subset(Coral.survivorship, Day.77=="alive") %>% select(PLUG.ID)
wk11_occur <- data.frame(table(Week11_IDs$PLUG.ID))
wk11_occur[wk11_occur$Freq > 1,] ## duplicates in blch score
Week11_mismatched <- setdiff(Week11_IDs, Day77_IDs) 
Week11_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 12: 20181214; Day 84
Week12_IDs <- subset(Bleaching.fragments, Timepoint=="Week12") %>% select(PLUG.ID)
Day84_IDs <- subset(Coral.survivorship, Day.84=="alive") %>% select(PLUG.ID)
wk12_occur <- data.frame(table(Week12_IDs$PLUG.ID))
wk12_occur[wk12_occur$Freq > 1,] ## duplicates in blch score
Week12_mismatched <- setdiff(Week12_IDs, Day84_IDs) 
Week12_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 13: 20181221; Day 91
Week13_IDs <- subset(Bleaching.fragments, Timepoint=="Week13") %>% select(PLUG.ID)
Day91_IDs <- subset(Coral.survivorship, Day.91=="alive") %>% select(PLUG.ID)
wk13_occur <- data.frame(table(Week13_IDs$PLUG.ID))
wk13_occur[wk13_occur$Freq > 1,] ## duplicates in blch score
Week13_mismatched <- setdiff(Week13_IDs, Day91_IDs) 
Week13_mismatched ## plug ids that appear in blch score but not as alive on that day

## Week 14: 20181231; Day 101
Week14_IDs <- subset(Bleaching.fragments, Timepoint=="Week14") %>% select(PLUG.ID)
Day101_IDs <- subset(Coral.survivorship, Day.101=="alive") %>% select(PLUG.ID)
wk14_occur <- data.frame(table(Week14_IDs$PLUG.ID))
wk14_occur[wk14_occur$Freq > 1,] ## duplicates in blch score
Week14_mismatched <- setdiff(Week14_IDs, Day101_IDs) 
Week14_mismatched 

## Week 15: 20190107; Day 108
Week15_IDs <- subset(Bleaching.fragments, Timepoint=="Week15") %>% select(PLUG.ID)
Day108_IDs <- subset(Coral.survivorship, Day.108=="alive") %>% select(PLUG.ID)
wk15_occur <- data.frame(table(Week15_IDs$PLUG.ID))
wk15_occur[wk15_occur$Freq > 1,] ## duplicates in blch score
Week15_mismatched <- setdiff(Week15_IDs, Day108_IDs) 
Week15_mismatched 

## Week 16: 20190111; Day 112
Week16_IDs <- subset(Bleaching.fragments, Timepoint=="Week16") %>% select(PLUG.ID)
Day112_IDs <- subset(Coral.survivorship, Day.112=="alive") %>% select(PLUG.ID)
wk16_occur <- data.frame(table(Week16_IDs$PLUG.ID))
wk16_occur[wk16_occur$Freq > 1,] ## duplicates in blch score
Week16_mismatched <- setdiff(Week16_IDs, Day112_IDs) 
Week16_mismatched 

#### Checking that plug.id is associated with the correct species in both Bleaching and Buoyant Weight
Master_sp <- Master.fragment %>% select(PLUG.ID, Species)
  Master_sp <- Master_sp %>% rename(Master_ID = PLUG.ID)


### Checking all Plug ID and treatments match on master spreadsheet, Bleaching, and BW

### Printing sample sizes 
