---
title: "Environmental_Data"
author: "EL Strand"
date: "5/27/2020"
output:
<<<<<<< HEAD:Environmental_data/Environmental_Data.Rmd
  pdf_document: default
  html_document: default
=======
  html_document: default
  pdf_document: default
>>>>>>> f9e1a2d2ed0e0c3678a201414915d46b95a1197b:Scripts/Environmental_Data.Rmd
---

Select Knit > Project Directory
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clear workspace. 
```{r}
rm(list=ls()) 
```

Required packages for the below analyses.
```{r}
library(plyr) # plyr needs to be loaded before dplyr
library(dplyr)
library(tidyr)
library(xml2)
library(tidyverse)
library(ggplot2)
library(scales)
library(lubridate)
library(patchwork) # To display 2 charts together
library(hrbrthemes)
library(reshape2)
library(gridExtra)
library(plotrix)
library(Rmisc)
library(lattice)
library(viridis)
library(dygraphs)
library(xts)
library(graphics)
library(janitor)

colors <- c("lightblue", "blue", "salmon", "red3")
```

### NOAA BUOY DATA ###

**CRIMP2 NOAA Buoy Data files**: 
Nov 2012 - June 2013
June 2013 - Nov 2013
Nov 2013 - June 2014 
June 2014 - May 2015
Aug 2015 - Sept 2016  
Nov 2016 - Dec 2017  (missing Oct 2016)
Dec 2017 - May 2018  
May 2018 - Feb 2019 

```{r}
#bind all CRIMP logger data sets together
CRIMP2.data <-
  list.files(path = 'Environmental_data/CRIMP2-buoy', pattern = ".csv", full.names = TRUE) %>% # list files in directory following a particular pattern
  set_names(.) %>% # get the column names
  map_dfr(read.table, .id = "file.ID", header=FALSE, skip=5, sep=",") %>% # join all files together in one data frame by file ID
  group_by(file.ID) %>% # for each file do the following
  select(V4, V5, V15, V22) %>% # I ran lines 58-62 first to view the column names and decide which ones I wanted to keep and then changed skip=4 to skip=5
  dplyr::rename(Date=`V4`, # Date
                Time=`V5`, # Time
                Temp=`V15`, # SST C
                pCO2=`V22`) %>% #pCO2 SW (sat) uatm chosen
  unite(Date.Time, Date, Time, sep=" ")

CRIMP2.data$Date.Time <- mdy_hm(CRIMP2.data$Date.Time, quiet=FALSE, tz="UTC", truncated=0) #format date and time 
CRIMP2.data$Data.Source <- "CRIMP2"

crimp.colors <- c("lightblue", "blue", "black", "salmon", "red3")

#### Temperature
CRIMP2.temp <- CRIMP2.data %>% select(-pCO2) %>% filter(Temp>0)
## need to run HOBO logger section prior to overlaying experimental data on CRIMP2's data
EXPT.temp <- Hobo.means %>% select(Date.Time, Treatment, Temperature) %>% dplyr::rename(Data.Source = Treatment, Temp = Temperature)
EXPT.temp$file.ID <- "EXPT"
CRIMP2.EXPT.temp <- bind_rows(CRIMP2.temp, EXPT.temp) #combining both dataframes 

# generate all combinations of year/group
d <- expand.grid(min(CRIMP2.EXPT.temp$Date):max(CRIMP2.EXPT.temp$Date), unique(CRIMP2.EXPT.temp$Date.Source))
# fill NA if combination is missing
d$val <- apply(d, 1,
               function(x) if (nrow(subset(CRIMP2.EXPT.temp, Date.Time == x[1] & Data.Source == x[2]))) 0 else NA)
# modify the original dataset
names(d) <- c("year", "group", "value")
data <- rbind(data, d[is.na(d$val), ])
ggplot(data, aes(x=year, y=value,
                 group=as.factor(group), colour=as.factor(group))) + geom_line()


CRIMP.TEMP.PLOT <- ggplot(data = CRIMP2.EXPT.temp, aes(x = Date.Time, y = Temp, color = Data.Source)) +
  labs(x = "Date (Month-Year)", y = "Sea Surface Temperature (°C)") + ggtitle("CRIMP2 NOAA Buoy") +
  geom_line(size=0.15) +
  scale_color_manual(values = crimp.colors) + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_datetime(date_breaks = "60 days", labels = date_format("%b %y")) +
  geom_hline(aes(yintercept = 29.5), col = "red", linetype="dotted") +
  theme(legend.position="right", legend.background = element_blank()); CRIMP.TEMP.PLOT 

ggsave(file="Output/CRIMP2-Temperature.png", CRIMP.TEMP.PLOT, width = 11, height = 6, units = c("in"))

#### pCO2
CRIMP2.pCO2 <- CRIMP2.data %>% select(-Temp) %>% filter(pCO2>0)
## need to run Carb Chem script to get output to overlay experimental data on CRIMP'S data 
EXPT.pCO2 <- read.csv("Environmental_data/Seawater_chemistry_table_Output_All.csv") %>% select(Timepoint, Treatment, pCO2) %>% 
  dplyr::rename(Data.Source = Treatment, Date = Timepoint) %>% filter(Data.Source != "Acclimation")
EXPT.pCO2$file.ID <- "EXPT"
EXPT.pCO2$Time <- "11:00"
EXPT.pCO2 <- EXPT.pCO2 %>% unite(Date.Time, Date, Time, sep=" ")
EXPT.pCO2$Date.Time <- ymd_hm(EXPT.pCO2$Date.Time, quiet=FALSE, tz="UTC", truncated=0) #format date and time the order of ymd_hm will depend on original format

CRIMP2.EXPT.pCO2 <- bind_rows(CRIMP2.pCO2, EXPT.pCO2) #combining both dataframes 

CRIMP.pCO2.PLOT <- ggplot(data = CRIMP2.EXPT.pCO2, aes(x = Date.Time, y = pCO2, color = Data.Source)) +
  labs(x = "Date (Month-Year)", y = "pCO2 (uatm)") + ggtitle("CRIMP2 NOAA Buoy") +
  geom_line(size=0.15) +
  scale_color_manual(values = crimp.colors) + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_datetime(date_breaks = "60 days", labels = date_format("%b %y")) +
  theme(legend.position="right", legend.background = element_blank()); CRIMP.pCO2.PLOT 

ggsave(file="Output/CRIMP2-pCO2.png", CRIMP.pCO2.PLOT, width = 11, height = 6, units = c("in"))
```


### APEX TEMPERATURE AND pH DATA ### 

Apex files were downloaded every 2 days and kept in seperate files. 
The Sept 18-21 acclimation data file formatting is different - this was probably downloaded differently. Taken out for now. 

Sept 22-24 columns match, Sept 26-Nov 19 columns match. Need to do this separately. 

The PAR sensor was in Tank 1 for the entire experiment. There are other discrete light measurements. 

Reading in data files. 
```{r}
# read in tank to treatment values to bind dataframes together later on 
Trt.Tanks <- read.csv('Environmental_data/Tank_to_Treatment.csv') %>% select(-Tank.Name)
Trt.Tanks$Tank <- as.character(Trt.Tanks$Tank)

# binding all apex data files together. see above note about some need to be loaded differently
APEX.data1 <- list.files(path = 'Environmental_data/Apex_continuous_data/Download1', pattern = ".csv", full.names = TRUE) %>% # list files in directory following a particular pattern
  set_names(.) %>% # get the column names
  map_dfr(read.table, .id = "file.ID", header=FALSE, sep=",") %>% # join all files together in one data frame by file ID
  group_by(file.ID) %>% # for each file do the following
  select(-V1) %>% 
  row_to_names(row_number=1) %>% rename(file.ID = "Environmental_data/Apex_continuous_data/Download1/Experimental_0922.csv") %>%
  filter(Date.Time != "Date.Time")

APEX.data2 <- list.files(path = 'Environmental_data/Apex_continuous_data/Download2', pattern = ".csv", full.names = TRUE) %>% # list files in directory following a particular pattern
  set_names(.) %>% # get the column names
  map_dfr(read.table, .id = "file.ID", header=FALSE, sep=",") %>% # join all files together in one data frame by file ID
  group_by(file.ID) %>% # for each file do the following
  select(-V1) %>%
  row_to_names(row_number=1) %>% rename(file.ID = "Environmental_data/Apex_continuous_data/Download2/Experimental_0925_0926.csv") %>%
  filter(Date.Time != "Date.Time")

APEX.data1$Date.Time <- ymd_hms(APEX.data1$Date.Time, quiet=FALSE, tz="UTC", truncated=0)
APEX.data2$Date.Time <- ymd_hms(APEX.data2$Date.Time, quiet=FALSE, tz="UTC", truncated=0)

Apex.Temp1 <- APEX.data1 %>% select(-contains("pH"), -PAR, -file.ID) %>%
  gather("Tank", "Temp", 3:14) 
Apex.Temp2 <- APEX.data2 %>% select(-contains("pH"), -PAR, -file.ID) %>%
  gather("Tank", "Temp", 2:13) 
Apex.Temp <- bind_rows(Apex.Temp1, Apex.Temp2)
Apex.Temp$Tank <- gsub("^.{0,4}", "", Apex.Temp$Tank)
Apex.Temp <- full_join(Apex.Temp, Trt.Tanks, by="Tank") 
Apex.Temp$Temp <- as.numeric(Apex.Temp$Temp) 
Apex.Temp <- Apex.Temp %>% filter(Temp>20)

Apex.pH <- APEX.data %>% select(-contains("Tmp"), -PAR, -file.ID) %>%
  gather("Tank", "pH", 3:14) 
Apex.pH$Tank <- gsub("^.{0,3}", "", Apex.pH$Tank)
Apex.pH <- full_join(Apex.pH, Trt.Tanks, by="Tank")


Apex.PAR <- APEX.data %>% select(-contains("Tmp"), -contains("pH"))
```

```{r}
APEX.TEMP.PLOT <- ggplot(data = Apex.Temp, aes(x = Date.Time, y = Temp, color = Treatment)) +
  labs(x = "Date", y = "Temperature") + ggtitle("Apex Sensor") +
  geom_line() +
  scale_color_manual(values = colors) + 
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_datetime(date_breaks = "2 days", labels = date_format("%d %b")) +
  theme(legend.position="right", legend.background = element_blank()); APEX.TEMP.PLOT 

#junk package? magic package? janitor?

```





Read in raw Apex download files with light, temperature, and pH. 
Improvements:
1.) Create loop for the select(apexX, -X) function so it is not repetitive.
2.) Come back to switching time format for Apex 1. 
```{r}
## Reading in apex continuous data: temperature and pH 
apex1 <- read.csv('Environmental_data/Apex_continuous_data/Acclimation_0918_0921.csv') ## NEED TO SWITCH TIME FORMAT
apex2 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_0922.csv')
   apex2 <- select(apex2, -X) # removing column labeled X
apex3 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_0923.csv')
  apex3 <- select(apex3, -X) 
apex4 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_0924.csv')
  apex4 <- select(apex4, -X) 
apex5 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_0925_0926.csv')
  apex5 <- select(apex5, -X) 
apex6 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_0926_0927.csv')
  apex6 <- select(apex6, -X) 
apex7 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_0929.csv')
  apex7 <- select(apex7, -X)
apex8 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_1001.csv')
  apex8 <- select(apex8, -X)
apex9 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_1003.csv')
  apex9 <- select(apex9, -X)
apex10 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_1005.csv')
  apex10 <- select(apex10, -X)
apex11 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_1007.csv')
  apex11 <- select(apex11, -X)
apex12 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_1008.csv')
  apex12 <- select(apex12, -X)
apex13 <- read.csv('Environmental_data/Apex_continuous_data/Experimental_1119.csv')
  apex13 <- select(apex13, -X)
```

Transforming data to desired format. 
```{r}
Apex_data <- bind_rows(apex2, apex3, apex4, apex5, apex6, apex7, apex8, apex9, apex10, apex11, apex12, apex13) %>% select(-Tmp_4.1) ## Joining dataframes apex1 - apex13
Apex_data <- Apex_data[,order(colnames(Apex_data))] # ordering columns alphabetically 
Apex_data <- Apex_data %>% gather("Tank", "pH", 3:14) # creates a Tank_number column and pH value column to transform tank columns into rows
Apex_data <- Apex_data %>% gather("Temp_Tank", "Temperature", 3:14)  %>% select(-Temp_Tank) # creates another Tank column and Temperature value column to transform tank columns into rows
Apex_data$Tank <- gsub("^.{0,3}", "", Apex_data$Tank) # removing the first three characters aka "pH_" of each element to be just tank number 


# Double checking format before moving on.
head(Apex_data)
tail(Apex_data)
```

Grouping by treatment
```{r}
Trt.Tanks <- read.csv('Environmental_data/Tank_to_Treatment.csv') %>% select(-Tank.Name)
Trt.Tanks$Tank <- as.character(Trt.Tanks$Tank) # changing Tank column character

Apex_treatment <- full_join(Apex_data, Trt.Tanks, by = "Tank") 
head(Apex_treatment)
```

Calculating average based on treatment and Date.Time
Summarizing statistics: mean, N, standard deviation, standard error, confidence interval 
```{r}
Apex_temp_means <- summarySE(Apex_treatment, measurevar="Temperature", groupvars=c("Date.Time", "Treatment")) %>% na.omit(Temperature)
  colnames(Apex_temp_means) <- c("Date.Time", "Treatment", "Temp_N", "Temperature", "Temp_sd", "Temp_se", "Temp_ci")
Apex_pH_means <- summarySE(Apex_treatment, measurevar="pH", groupvars=c("Date.Time", "Treatment")) %>% na.omit(pH)
  colnames(Apex_pH_means) <- c("Date.Time", "Treatment", "pH_N", "pH", "pH_sd", "pH_se", "pH_ci")
## come back to N = 36
  
Apex_means <- full_join(Apex_temp_means, Apex_pH_means, by = "Date.Time") %>% select(-Treatment.y) %>% rename(Treatment = Treatment.x)
tail(Apex_means)
```

Graphing apex temperature continuous data 
Decide later if want to add in confidence intervals or standard error bars. 
```{r}
colors <- c("blue", "lightblue", "salmon", "red3")

ggplot(Apex_temp_means, aes(x=Date.Time, y = Temperature, group = Treatment, color = Treatment)) + 
  geom_line() + theme_bw() +
  scale_color_manual(values = colors) + 
  scale_shape_manual(values=c(21,24), name = "Treatment") +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Date") + theme(axis.text.x=element_text(angle=60, hjust=1)) + # x-axis label and rotating text on x axis
  ylab("Temperature °C") + ylim(c(26,30)) + # y-axis label and y axis range
  ggtitle("Apex Temperature Data") + theme(plot.title = element_text(hjust = 0.5)) + # title label and centering the title
  theme(legend.position=c(0.9, 0.8), legend.background = element_blank())  

## come back to temperature being the same for all treatments - hm.
```

Graphing apex pH continuous data 
Decide later if want to add in confidence intervals or standard error bars. 
```{r}
colors <- c("blue", "lightblue", "salmon", "red3")

ggplot(Apex_pH_means, aes(x=Date.Time, y = pH, group = Treatment, color = Treatment)) + 
  geom_line() + theme_bw() +
  scale_color_manual(values = colors) + 
  scale_shape_manual(values=c(21,24), name = "Treatment") +
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Date") + theme(axis.text.x=element_text(angle=60, hjust=1)) + # x-axis label and rotating text on x axis
  ylab("pH") + # y-axis label and y axis range
  ggtitle("Apex pH Data") + theme(plot.title = element_text(hjust = 0.5)) + # title label and centering the title
  theme(legend.text = element_text(size = 10))  
```


### HOBO LOGGER TEMPERATURE DATA ###  

Reading in and transforming hobo logger data. 
```{r}
tankIDs <- read.csv('Environmental_data/Tank_to_Treatment.csv')
tankIDs$Tank <- as.character(tankIDs$Tank)
  
#bind all hobo logger data sets together
Hobo.data <-
  list.files(path = 'Environmental_data/Temp_Hobo_Loggers', pattern = ".csv", full.names = TRUE) %>% # list files in directory following a particular pattern
  set_names(.) %>% # get the column names
  map_dfr(read.table, .id = "file.ID", header=FALSE, skip=1, sep=",") %>% # join all files together in one data frame by file ID
  group_by(file.ID) %>% # for each file do the following
  select(-V1) %>% dplyr::rename(Date.Time = V2, Temperature = V3)

Hobo.data$Date.Time <- mdy_hm(Hobo.data$Date.Time, quiet=FALSE, tz="UTC", truncated=0) #format date and time 

file.name <- c("Environmental_data/Temp_Hobo_Loggers/20190117_Tank1.csv", 
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank2.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank3.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank4.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank5.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank6.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank7.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank8.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank9.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank10.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank11.csv",
               "Environmental_data/Temp_Hobo_Loggers/20190117_Tank12.csv")
tank.ID <- c("1", "2", "3", "4", "5", "6", "7", "8", "9", "10", "11", "12")
Hobo.data$Tank <- tank.ID[match(Hobo.data$file.ID, file.name)] #adding a tank number column based on the file.ID column 
Hobo.data$Tank <- as.character(Hobo.data$Tank) 

Hobo.data <- left_join(Hobo.data, tankIDs) %>% select(-Tank.Name) #adding treatment info to each tank

Hobo.means <- summarySE(Hobo.data, measurevar = "Temperature", groupvars=c("Date.Time", "Treatment")) #N, mean(Temperature), sd, se, ci
```

Need to filter out times that hobo logger was out of the water. 

Visualizing data. 
```{r}
colors <- c("lightblue", "blue", "salmon", "red3")

ggplot(data = Hobo.means, aes(x = Date.Time, y = Temperature, colour = Treatment)) +
  #geom_point(size=0.2) +
  scale_color_manual(values = colors) +
  labs(x = "Date",
       y = "Temperature (°C)") +
  geom_line(aes(group=Treatment)) +
  theme_bw() + theme(panel.border = element_blank(), panel.grid.major = element_blank(),
                     panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_x_datetime(date_breaks = "7 days", labels = date_format("%b %d")) +
  geom_vline(aes(xintercept = as.integer(as.POSIXct("2018-09-22 07:00:00"))), col = "black", linetype="dotted") +
  geom_vline(aes(xintercept = as.integer(as.POSIXct("2018-11-17 07:00:00"))), col = "black", linetype="dotted") +
  theme(legend.position=c(0.9, 0.8), legend.background = element_blank()) 

ggsave(filename = "Output/Hobo-loggers.pdf", device = "pdf", width = 11, height = 8)
ggsave(filename = "Output/Hobo-loggers.png", device = "png", width = 11, height = 8)
```


### LIGHT DATA ### 

Decide if want to visualize/statistically analyze the positions the readings were taken in (6 points in each tank)

Reading in both light data files. 
The PAR sensor was only in one tank so we only need to subset our Apex_data frame to one tank. 
```{r}
Apex_Light <- subset(Apex_data, Tank=="1") %>% select(Date.Time, PAR) 
# PAR$Date.Time <- parse_date_time(PAR$Date.Time, "%m/%d/%y %I:%M:%S %p", tz="HST")
Licor_Light <- read.csv('Environmental_data/Discrete_Light_Licor193.csv', sep=",")

Light_tank_info <-read.csv('Environmental_data/Tank_to_Treatment.csv', header=T, sep=",") %>% select(-Tank.Name)
Licor_Light <- merge(Licor_Light, Light_tank_info, by="Tank") 
Licor_Light$Tank <- as.character(Licor_Light$Tank) # changing Tank values to character instead of numeric
```

Visualizing Apex light data. 
```{r}
## Apex Data
ggplot(Apex_Light, aes(x=Date.Time, y = PAR)) + 
  geom_line() + theme_bw() +
  # scale_fill_manual(values = "yellow")  
  theme(panel.border = element_blank(), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Date") + theme(axis.text.x=element_text(angle=60, hjust=1)) + # x-axis label and rotating text on x axis
  ylab("PAR")  # y-axis label 

## stuck on same issue as Apex data, trimming the date down
```

Testing if is there a significant difference between tank positions. 
```{r}
Licor_bytank <- Licor_Light %>% subset(Measure_Type=="Six-point") %>% subset(Instrument=="LICOR-193")
Licor_means <- summarySE(Licor_bytank, measurevar="PAR", groupvars=c("Position", "Tank"))

licor_anova <- aov(PAR ~ Position, data = Licor_bytank)
summary(licor_anova)
```

Visualizing Licor light data. 
This includes six-point and one-point measurements, and both hand-held apogee and LICOR-193 instruments. 
```{r}
treatment_colors <- c("blue", "lightblue", "salmon", "red3")
tank_colors <- c("blue", "red3", "lightblue", "lightblue", "red3", "lightblue", "salmon", "red3", "blue", "salmon", "blue", "salmon")

## BY TREATMENT
ggplot(Licor_Light, aes(x=Treatment, y=PAR, fill=Treatment)) + 
  geom_boxplot() +
  scale_fill_manual(values = treatment_colors) +
  geom_jitter(color="black", size=0.4, alpha=0.9) + 
  theme_classic() + 
  theme(legend.position="none", plot.title = element_text(size=11)) + 
  xlab("Treatment") + 
  ylab("PAR")

## BY TREATMENT AND TANK
ggplot(Licor_Light, aes(x=Tank, y=PAR, fill=Tank)) + 
  geom_boxplot() +
  scale_fill_manual(values = tank_colors) +
  scale_x_discrete(limits=c("1","6","8", "3", "11", "12", "4", "7", "9", "2", "5", "10")) + 
  geom_jitter(color="black", size=0.4, alpha=0.9) + 
  theme_classic() + 
  theme(legend.position="none", plot.title = element_text(size=11)) + 
  xlab("Tank Number") + 
  ylab("PAR")
```


### FLOW RATES ### 

Reading in flow rate and tank to treatment data files. 
```{r}
Flow_tank_info <-read.csv('Environmental_data/Tank_to_Treatment.csv', header=T, sep=",") %>% select(-Tank.Name)
Flow_Data <- read.csv('Environmental_data/Flow_rate.csv', header=T, sep=",") %>% select(-Trial, -Rate)
Flow_Data <- subset(Flow_Data, Final_Rate=="Yes") # subsetting to only the final rates 
Flow_Data$Tank <- as.character(Flow_Data$Tank) # changing Tank values to character instead of numeric
```

Merging the two datafiles by Tank and ordering by specific Tank name (based on treatments)
```{r}
Flow_Data <- merge(Flow_Data, Flow_tank_info, by="Tank")
Flow_Data$ml.sec <- Flow_Data$Volume.ml/Flow_Data$Time.sec
```

Visualizing flow rate data. 
```{r}
treatment_colors <- c("blue", "lightblue", "salmon", "red3")
tank_colors <- c("blue", "red3", "lightblue", "lightblue", "red3", "lightblue", "salmon", "red3", "blue", "salmon", "blue", "salmon")

## BY TREATMENT
ggplot(Flow_Data, aes(x=Treatment, y=ml.sec, fill=Treatment)) + 
  geom_boxplot() +
  scale_fill_manual(values = treatment_colors) +
  geom_jitter(color="black", size=0.4, alpha=0.9) + 
  theme_classic() + 
  theme(legend.position="none", plot.title = element_text(size=11)) + 
  xlab("Treatment") + 
  ylab("Flow Rates (mL/sec)")

## BY TREATMENT AND TANK
ggplot(Flow_Data, aes(x=Tank, y=ml.sec, fill=Tank)) + 
  geom_boxplot() +
  scale_fill_manual(values = tank_colors) +
  scale_x_discrete(limits=c("1","6","8", "3", "11", "12", "4", "7", "9", "2", "5", "10")) + 
  geom_jitter(color="black", size=0.4, alpha=0.9) + 
  theme_classic() + 
  theme(legend.position="none", plot.title = element_text(size=11)) + 
  xlab("Tank Number") + 
  ylab("Flow Rates (mL/sec)")
```

Statistical analyses. 
```{r}
tank.lm <- lm(ml.sec ~ Tank, data=Flow_Data)
tank.anova <- aov(ml.sec ~ Tank, data=Flow_Data)
summary(tank.lm)
summary(tank.anova)

trt.lm <- lm(ml.sec ~ Treatment, data=Flow_Data)
trt.anova <- aov(ml.sec ~ Treatment, data=Flow_Data)
summary(trt.lm)
summary(trt.anova)
```

