---
title: "Respirometry"
author: "EL Strand"
date: "6/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Clears workspace. 
```{r}
rm(list=ls())
```

Load required packages. 
```{r}
## Installing if package is not already downloaded
if ("devtools" %in% rownames(installed.packages()) == 'FALSE') install.packages('devtools') 
library(devtools)
if ("segmented" %in% rownames(installed.packages()) == 'FALSE') install.packages('segmented') 
if ("plotrix" %in% rownames(installed.packages()) == 'FALSE') install.packages('plotrix') 
if ("gridExtra" %in% rownames(installed.packages()) == 'FALSE') install.packages('gridExtra') 
if ("LoLinR" %in% rownames(installed.packages()) == 'FALSE') install_github('colin-olito/LoLinR') 
if ("lubridate" %in% rownames(installed.packages()) == 'FALSE') install.packages('lubridate') 
if ("chron" %in% rownames(installed.packages()) == 'FALSE') install.packages('chron') 
if ("plyr" %in% rownames(installed.packages()) == 'FALSE') install.packages('plyr') 
if ("dplyr" %in% rownames(installed.packages()) == 'FALSE') install.packages('dplyr') 
if ("ggpubr" %in% rownames(installed.packages()) == 'FALSE') install.packages('ggpubr') 
if ("car" %in% rownames(installed.packages()) == 'FALSE') install.packages('car') 
if ("ggstatsplot" %in% rownames(installed.packages()) == 'FALSE') install.packages('ggstatsplot') 

## Read in libraries. 
install_github('colin-olito/LoLinR')
library("ggplot2")
library("segmented")
library("plotrix")
library("gridExtra")
library("LoLinR")
library("lubridate")
library("chron")
library('plyr')
library('dplyr')
library('stringr')
library('Rmisc')
library("ggpubr")
library("car")
library("ggstatsplot")
```

Load in respiration files and creating a blank data frame to be filled in by calculated data later on.  
```{r}
path.p <- "Physiology_variables/Respirometry/Raw_Data/" #the location of all your respirometry files 

file.names <- basename(list.files(path = path.p, pattern = "csv$", recursive = TRUE)) #list all csv file names in the folder and subfolders
#basename above removes the subdirectory name from the file

#generate a 3 column dataframe with specific column names
Photo.R <- data.frame(matrix(NA, nrow=length(file.names)*2, ncol=3)) 
colnames(Photo.R) <- c("Fragment.ID","Intercept", "umol.L.sec")

#add file names that include the subdirectory name
file.names.full <- list.files(path = path.p, pattern = "csv$", recursive = TRUE) #list all csv file names in the folder and subfolders
```

Calculating respiration rates. 
```{r}
PR <- c('Photo', 'Resp')

for(i in 1:length(file.names.full)) { # for every file in list start at the first and run this following function
  Photo.Data1 <-read.table(file.path(path.p,file.names.full[i]), skip = 1, header=T, sep=",", na.string="NA", fill = TRUE, as.is=TRUE, fileEncoding="latin1") #reads in the data files
  Photo.Data1 <- Photo.Data1[with(Photo.Data1, order(Time)), ]
  Photo.Data1  <- Photo.Data1[,c(2,9,16)] #subset columns of interest
  n<-dim(Photo.Data1)[1] #identify length of data
  Photo.Data1 <-Photo.Data1[120:(n-3),] #start at data point ~2 minute in to avoid excess noise from start of run and remove last 3 lines containing text
  Photo.Data1$Time <- as.POSIXct(Photo.Data1$Time,format="%H:%M:%S", tz = "") #convert time from character to time
  Photo.Data1$x <- as.numeric(rownames(Photo.Data1))
  brk <- which(diff(Photo.Data1$Time) > 30) #look for breaks in time of x seconds or more
  brk <- Photo.Data1[brk,4]
  Photo <- subset(Photo.Data1, as.numeric(rownames(Photo.Data1)) < brk[1])  #subset by break in time stamp keeping everything before break
  Resp <- subset(Photo.Data1, as.numeric(rownames(Photo.Data1)) > brk[1]) #subset by break in time stamp keeping everything before break
  lt.levs <- list(Photo, Resp) #list levels of segmentation
  
  for(j in 1:length(lt.levs)){    
    Photo.Data <- as.data.frame(lt.levs[j])
    n<-dim(Photo.Data )[1] #identify length of data
    #Photo.Data <-Photo.Data [120:(n-3),] #start at data point ~2 minute in to avoid excess noise from start of run and remove last 3 lines containing text
    #n<-dim(Photo.Data )[1] #list length of trimmed data
    Photo.Data$sec <- 1:n #set seconds by one from start to finish of run
    
    #Save plot prior to and after data thinning to make sure thinning is not too extreme
    rename <- sub(".csv", "", file.names[i])
    pdf(paste0("Physiology_variables/Respirometry/Output/Data_thinning/",rename,"_",j,"thinning.pdf"))
    par(omi=rep(0.3, 4)) #set size of the outer margins in inches
    par(mfrow=c(1,2)) #set number of rows and columns in multi plot graphic
    plot(Value ~ sec, data=Photo.Data , xlab='Time (seconds)', ylab=substitute(' O'[2]~' (µmol/L)'), type='n', axes=FALSE) #plot data as a function of time
    usr  <-  par('usr')
    rect(usr[1], usr[3], usr[2], usr[4], col='grey90', border=NA)
    whiteGrid()
    box()
    points(Photo.Data$Value ~ Photo.Data $sec, pch=16, col=transparentColor('dodgerblue2', 0.6), cex=1.1)
    axis(1)
    axis(2, las=1)
    
    #save original unthinned and thinned data figure for comparison
    thin <- 30
    alp <- 0.2
    Photo.Data.orig<-Photo.Data
    Photo.Data <-  thinData(Photo.Data ,by=thin)$newData1 #thin data by every x points for all the O2 values
    Photo.Data$sec <- as.numeric(rownames(Photo.Data)) #maintain numeric values for time
    Photo.Data$Temp<-NA
    Photo.Data$Temp <-  thinData(Photo.Data.orig,xy = c(1,3),by=thin)$newData1[,2] #thin data by every 20 points for the temp values
    
    plot(Value ~ sec, data=Photo.Data , xlab='Time (seconds)', ylab=substitute(' O'[2]~' (µmol/L)'), type='n', axes=FALSE) #plot thinned data
    usr  <-  par('usr') #plotting graphics using 'usr'
    rect(usr[1], usr[3], usr[2], usr[4], col='grey90', border=NA) #giving specific coordinates for plot using 'usr'
    whiteGrid()
    box()
    points(Photo.Data$Value ~ Photo.Data$sec, pch=16, col=transparentColor('dodgerblue2', 0.6), cex=1.1)
    axis(1)
    axis(2, las=1)
    dev.off()
    
    ##Olito et al. 2017: It is running a bootstrapping technique and calculating the rate based on density
    Regs  <-  rankLocReg(xall=Photo.Data $sec, yall=Photo.Data $Value, alpha=alp, 
                         method="pc", verbose=TRUE) 
    pdf(paste0("Physiology_variables/Respirometry/Output/Regressions/",rename,"_",j,"regression.pdf"))
    plot(Regs)
    dev.off()
    
    s <- seq(0,nrow(Photo.R),length(lt.levs)) #to order the file output sequence in correct order in data frame
    Photo.R[j+s[i],2:3] <- Regs$allRegs[1,c(4,5)] #inserts slope and intercept in the dataframe
    Photo.R[j+s[i],1] <- rename #stores the file name in the Date column
    Photo.R[j+s[i],1] <- paste0(rename,"_",j) #stores the file name in the Date column
    Photo.R[j+s[i],4] <- mean(Photo.Data$Temp, na.rm=T)  #stores the Temperature in the Temp.C column
    Photo.R[j+s[i],5] <- PR[j] #stores whether it is photosynthesis or respiration
  }
}

write.csv(Photo.R, 'Physiology_variables/Respirometry/Output/Photo.R.csv')
```

Reading the dataframe in to skip calculating all regressions each time. 
```{r}
Photo.R <- read.csv(file="Physiology_variables/Respirometry/Output/Photo.R.csv", header=T) #read in volume and sample.info data
Photo.R <- Photo.R[,-1]

Photo.R$Fragment.ID <- str_sub(Photo.R$Fragment.ID, 1, str_length(Photo.R$Fragment.ID)-2) #Removing _1 or _2
```

Load sample info spreadsheet in and merge with Photo.R file. 
```{r}
#Load Sample Info
Sample.Info <- read.csv(file="Physiology_variables/Respirometry/Resp_DeltaTA_datasheet.csv", header=T) #read sample.info data
Sample.Info$Fragment.ID <- sub(".csv", "", Sample.Info$Fragment.ID)
Sample.Info$Blnk.Group <- paste(Sample.Info$Date, Sample.Info$Tank, Sample.Info$Light.or.Dark, sep = "_")
Sample.Info$Merge.ID <- paste(Sample.Info$Fragment.ID, Sample.Info$Light.or.Dark, sep = "_") 

#Merge data with sample info
colnames(Photo.R) <- c("Fragment.ID", "Intercept","umol.L.sec", "Temp","Light.or.Dark" )
Photo.R$Merge.ID <- paste(Photo.R$Fragment.ID, Photo.R$Light.or.Dark, sep = "_")
Data <- merge(Photo.R,Sample.Info, by="Merge.ID" )
```

Account for chamber volume to convert from umol L-1 s-1 to umol s-1. This standardizes across water volumes (different because of coral size) and remove per Liter.
```{r}
Data$umol.sec <- Data$umol.L.sec * (Data$Vol.ml/1000)
Data$Group <- paste(Data$Date, Data$Tank, Data$Light.or.Dark.x, sep = "_")
```

Accounting for blank chamber rates. 
The blanks have to be specific to the response variable (i.e. photo or resp), tank, and timepoint 
```{r}
#Calculate Photo blank rate
blnk <- aggregate(umol.sec ~ Date*Species*Tank*Light.or.Dark.x  , data=Data, mean)
Blanks <- subset(blnk, Species == "Blank")
Blanks$Group <- paste(Blanks$Date, Blanks$Tank, Blanks$Light.or.Dark.x, sep = "_")
boxplot(Blanks$umol.sec ~ Blanks$Tank)

Data <- merge(Data, Blanks, by="Group")

#Account for blank rate Subtract Blank by the temperature blank
Data$umol.sec.corr <- Data$umol.sec.x-Data$umol.sec.y
```

Normalize to surface area of the coral. 
```{r}
#normalize to surface area and h-1
Data$umol.cm2.hr <- (Data$umol.sec.corr*3600)/Data$Surface.Area
```

Removing blanks from the dataset and exporting both respirometry and photosynthetic rates. 
```{r}
Photo <- subset(Data, Light.or.Dark.x.x=="Photo")
Photo <- subset(Photo, Species.x!="Blank")
Resp <- subset(Data, Light.or.Dark.x.x=="Resp")
Resp <- subset(Resp, Species.x!="Blank")

write.csv(Photo, file="Physiology_variables/Respirometry/Output/Photosynthesis.rates.csv")
write.csv(Resp, file="Physiology_variables/Respirometry/Output/Respiration.rates.csv")
```

Calculating gross photosynthesis (Pnet -  negative Rdark)
```{r}
#merge desired columns by id
resp.data <- merge(Photo[,c(1,2,3,6,8,15,18,19,38)],Resp[,c(3,38)], by="Fragment.ID.x")

#rename the columns
names(resp.data)[names(resp.data) == "umol.cm2.hr.x"] <- "Pnet_umol.cm2.hr" 
names(resp.data)[names(resp.data) == "umol.cm2.hr.y"] <- "Rdark_umol.cm2.hr"

# calculating Pgross
resp.data$Pgross_umol.cm2.hr <- resp.data$Pnet_umol.cm2.hr - resp.data$Rdark_umol.cm2.hr
```

The following corals have been lost in transit from HI to RI or in a freezer in either location. 
```{r}
# Taking out the missing P. acuta fragments
Missing.list <- c("M-2976_20180923", "M-3003_20180923", "M-2008_20180923", "M-2512_20180923", "M-2528_20180929", "M-2740_20180929", "M-1603_20180929", "M-2200_20180929", "P-2880_20180923", "P-2752_20180923", "P-2522_20180923", "P-2523_20180923", "P-2981_20180929", "P-2984_20180929", "P-1739_20180929", "P-2859_20180929")
Missing.list <- as.list(Missing.list)
Missing <- resp.data[!grepl(paste(Missing.list, collapse = "|"), resp.data$Fragment.ID.x),]
```

Calculating means.
```{r}
AllMeans <- ddply(Missing, c('Date.x','Species.x', 'Treatment'), summarize,
                  #pnet
                  Pnet.mean= mean(Pnet_umol.cm2.hr, na.rm=T), #mean pnet
                  N = sum(!is.na(Pnet_umol.cm2.hr)), # sample size
                  Pnet.se = sd(Pnet_umol.cm2.hr, na.rm=T)/sqrt(N), #SE
                  #Rdark
                  Rdark.mean= mean(Rdark_umol.cm2.hr, na.rm=T), #mean rdark
                  Rdark.se = sd(Rdark_umol.cm2.hr, na.rm=T)/sqrt(N), #SE
                  #Pgross
                  Pgross.mean  = mean(Pgross_umol.cm2.hr, na.rm=TRUE),
                  Pgross.se = sd (Pgross_umol.cm2.hr, na.rm=TRUE)/sqrt(N))
AllMeans
colnames(AllMeans) <- c("Date", "Species", "Treatment", "Pnet.mean", "N",   "Pnet.se",  "Rdark.mean",   "Rdark.se", "Pgross.mean",  "Pgross.se")
AllMeans$Group <- paste(AllMeans$Species, AllMeans$Treatment, sep = "_")

# checking sample sizes
dplyr::filter(AllMeans, N < 6)

# exporting results 
write.csv(resp.data, file="Physiology_variables/Respirometry/Output/Resp_AllRates.csv") # raw data
write.csv(AllMeans, file="Physiology_variables/Respirometry/Output/Resp_AllMeans.csv") # Mean data
```

Subsetting by species and changing respiration values to absolute value. 
```{r}
# Adding timepoint column to AllMeans 
AllMeans <- AllMeans %>% 
  mutate(Timepoint = case_when(
    Date == "20180922" ~ "Day 1",
    Date == "20180923" ~ "Day 2", 
    Date == "20180929" ~ "1 week",
    Date == "20181006" ~ "2 week",
    Date == "20181020" ~ "4 week",
    Date == "20181103" ~ "6 week",
    Date == "20181117" ~ "8 week")
  )

AllMeans$Timepoint <- factor(AllMeans$Timepoint, levels=c("Day 1","Day 2","1 week","2 week","4 week","6 week","8 week"))

# Separating by species 
Pact  <- subset(AllMeans, Species=="Pocillopora")
Mcap <- subset(AllMeans, Species=="Montipora")

# Changing respiration rates to absolute values
Pact$Rdark.mean <- abs(Pact$Rdark.mean)
Mcap$Rdark.mean <- abs(Mcap$Rdark.mean)
```

Plotting respiration and photosynthetic rates. 
To plot a response variable with both species on one graph, use facet_wrap(~Species) function.
```{r}
colors <- c("lightblue", "blue", "salmon", "red3")

## Montipora capitata
Mcap.Pg <- ggplot(Mcap, aes(x=Timepoint, y = Pgross.mean, group = Treatment, color = Treatment)) +
  geom_line() + geom_point() +
  geom_errorbar(aes(ymin=Pgross.mean-Pgross.se, ymax=Pgross.mean+Pgross.se), width=.2) + 
  scale_color_manual(values = colors) + 
  xlab("Timepoint") +
  ylab(bquote('Gross Photosynthesis ('*mu~ 'mol' ~cm^-2*~ h^-1*')')) +
  ylim(c(0, 4.5)) + # y-axis label and y axis range
  labs(title = "M. capitata") +
  theme_classic() + 
  theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x=element_blank(),
        plot.title = element_text(face="bold.italic", hjust=0.5, size=20)) + 
  theme(axis.text.x = element_text(angle = 60, vjust = 1.2, hjust = 1.3)) #Set the text angle
Mcap.Pg 

Mcap.Pn <- ggplot(Mcap, aes(x=Timepoint, y = Pnet.mean, group = Treatment, color = Treatment)) +
  geom_line() + geom_point() +
  geom_errorbar(aes(ymin=Pnet.mean-Pnet.se, ymax=Pnet.mean+Pnet.se), width=.2) +
  scale_color_manual(values = colors) + 
  xlab("Timepoint") + theme(axis.text.x=element_text(angle=60, hjust=1)) + # x-axis label and rotating text on x axis
  ylab(bquote('Net Photosynthesis ('*mu~ 'mol' ~cm^-2*~ h^-1*')')) + 
  ylim(c(0, 3.5)) + # y-axis label and y axis range
  theme_classic()+
  theme(legend.position = "none",axis.title.x = element_blank(), axis.text.x=element_blank(), plot.title = element_text(face="bold")) + 
  theme(axis.text.x = element_text(angle = 60, vjust = 1.2, hjust = 1.3)) #Set the text angle
Mcap.Pn

Mcap.Rd <- ggplot(Mcap, aes(x=Timepoint, y = Rdark.mean, group = Treatment, color = Treatment)) +
  geom_line() + geom_point() + 
  geom_errorbar(aes(ymin=Rdark.mean-Rdark.se, ymax=Rdark.mean+Rdark.se), width=.2)+
  scale_color_manual(values = colors) + 
  xlab("Timepoint") +
  ylab(bquote('Dark Respiration ('*mu~ 'mol' ~cm^-2*~ h^-1*')')) +  
  ylim(c(0, 1.1)) + # y-axis label and y axis range
  theme_classic() + 
  theme(legend.position = "none",plot.title = element_text(face="bold")) + 
  theme(axis.text.x = element_text(angle = 60, vjust = 1.2, hjust = 1.3)) #Set the text angle
Mcap.Rd

## Pocillopora acuta
Pact.Pg <- ggplot(Pact, aes(x=Timepoint, y = Pgross.mean, group = Treatment, color = Treatment)) +
  geom_line() + geom_point() +
  geom_errorbar(aes(ymin=Pgross.mean-Pgross.se, ymax=Pgross.mean+Pgross.se), width=.2) +
  scale_color_manual(values = colors) + 
  xlab("Timepoint") + 
  ylab(bquote('Gross Photosynthesis ('*mu~ 'mol' ~cm^-2*~ h^-1*')')) + 
  ylim(c(0, 4.5)) + # y-axis label and y axis range
  labs(title = "P. acuta") +
  theme_classic() + 
  theme(legend.position = c(0.8, 0.9), axis.title.x = element_blank(), axis.text.x=element_blank(),
        plot.title = element_text(face="bold.italic", hjust=0.5, size=20)) + 
  theme(axis.text.x = element_text(angle = 60, vjust = 1.2, hjust = 1.3)) #Set the text angle
Pact.Pg

Pact.Pn <- ggplot(Pact, aes(x=Timepoint, y = Pnet.mean, group = Treatment, color = Treatment)) +
  geom_line() + geom_point() + 
  geom_errorbar(aes(ymin=Pnet.mean-Pnet.se, ymax=Pnet.mean+Pnet.se), width=.2) +
  scale_color_manual(values = colors) + 
  xlab("Timepoint") + theme(axis.text.x=element_text(angle=60, hjust=1)) + # x-axis label and rotating text on x axis
  ylab(bquote('Net Photosynthesis ('*mu~ 'mol' ~cm^-2*~ h^-1*')')) + # y-axis label and y axis range
  ylim(c(0, 3.5)) + # y-axis label and y axis range
  theme_classic()+
  theme(legend.position = "none", axis.title.x = element_blank(), axis.text.x=element_blank()) + 
  theme(axis.text.x = element_text(angle = 60, vjust = 1.2, hjust = 1.3)) #Set the text angle
Pact.Pn

Pact.Rd <- ggplot(Pact, aes(x=Timepoint, y = Rdark.mean, group = Treatment, color = Treatment)) +
  geom_line() + geom_point() +
  geom_errorbar(aes(ymin=Rdark.mean-Rdark.se, ymax=Rdark.mean+Rdark.se), width=.2) +
  scale_color_manual(values = colors) + 
  xlab("Timepoint") + 
  ylab(bquote('Dark Respiration ('*mu~ 'mol' ~cm^-2*~ h^-1*')')) + # y-axis label and y axis range
  ylim(c(0, 1.1)) + # y-axis label and y axis range
  theme_classic() + 
  theme(legend.position = "none") + 
  theme(axis.text.x = element_text(angle = 60, vjust = 1.2, hjust = 1.3)) #Set the text angle
Pact.Rd

# Resp.Figs <- combine_plots(Mcap.Pg, Pact.Pg, Mcap.Pn, Pact.Pn, Mcap.Rd,Pact.Rd,
  # labels = c("A", "D", "B", "E", "C", "F"), ncol=2)

Resp.Figs <- arrangeGrob(Mcap.Pg, Pact.Pg, Mcap.Pn, Pact.Pn, Mcap.Rd, Pact.Rd, ncol=2)

ggsave(file="Output/Final_Figures/Respirometry.pdf", Resp.Figs, width = 11, height = 10, units = c("in"))
ggsave(file="Output/Final_Figures/Respirometry.png", Resp.Figs, width = 11, height = 10, units = c("in"))
```

Statistical analyses. 
```{r}
index <- c("ATAC", "ATHC", "HTAC", "HTHC")
Tmp <- c("Ambient", "Ambient", "High", "High")
pCO2 <- c("Ambient", "High", "Ambient", "High")

resp.data$Tmp.Trt <- Tmp[match(resp.data$Treatment, index)]
resp.data$pCO2.Trt <- pCO2[match(resp.data$Treatment, index)]

Mcap.All <- subset(resp.data, Species.x=="Montipora")
Pact.All  <- subset(resp.data, Species.x=="Pocillopora") 

## P. acuta
# Net Photosynthetic Rates
Pact.Pnet.aov <- aov(Pnet_umol.cm2.hr ~ pCO2.Trt*Tmp.Trt*Date.x, data = Pact.All)
summary(Pact.Pnet.aov)
# TukeyHSD(Pact.Pnet.aov)

hist(Pact.Pnet.aov$residuals)
plot(Pact.Pnet.aov$fitted.values, Pact.Pnet.aov$residuals)
shapiro.test(Pact.Pnet.aov$residuals) 

# Gross Photosynthetic Rates
Pact.Pgross.aov <- aov(Pgross_umol.cm2.hr ~ pCO2.Trt*Tmp.Trt*Date.x, data = Pact.All)
summary(Pact.Pgross.aov)
#TukeyHSD(Pact.Pgross.aov)

hist(Pact.Pgross.aov$residuals)
plot(Pact.Pgross.aov$fitted.values, Pact.Pgross.aov$residuals)
shapiro.test(Pact.Pgross.aov$residuals) 

# Dark Respiration Rates
Pact.Rdark.aov <- aov(Rdark_umol.cm2.hr ~ pCO2.Trt*Tmp.Trt*Date.x, data = Pact.All)
summary(Pact.Rdark.aov)
#TukeyHSD(Pact.Rdark.aov)

hist(Pact.Rdark.aov$residuals)
plot(Pact.Rdark.aov$fitted.values, Pact.Rdark.aov$residuals)
shapiro.test(Pact.Rdark.aov$residuals) 


## M. capitata
# Net Photosynthetic Rates
Mcap.Pnet.aov <- aov(log10(Pnet_umol.cm2.hr) ~ pCO2.Trt*Tmp.Trt*Date.x, data = Mcap.All)
summary(Mcap.Pnet.aov)
#TukeyHSD(Mcap.Pnet.aov)

hist(Mcap.Pnet.aov$residuals)
plot(Mcap.Pnet.aov$fitted.values, Mcap.Pnet.aov$residuals)
shapiro.test(Mcap.Pnet.aov$residuals) 

# Gross Photosynthetic Rates
Mcap.Pgross.aov <- aov(log10(Pgross_umol.cm2.hr) ~ pCO2.Trt*Tmp.Trt*Date.x, data = Mcap.All)
summary(Mcap.Pgross.aov)
#TukeyHSD(Mcap.Pgross.aov)

hist(Mcap.Pgross.aov$residuals)
plot(Mcap.Pgross.aov$fitted.values, Mcap.Pgross.aov$residuals)
shapiro.test(Mcap.Pgross.aov$residuals) 

# Dark Respiration Rates
Mcap.Rdark.aov <- aov(Rdark_umol.cm2.hr ~ pCO2.Trt*Tmp.Trt*Date.x, data = Mcap.All)
summary(Mcap.Rdark.aov)
#TukeyHSD(Mcap.Rdark.aov)

hist(Mcap.Rdark.aov$residuals)
plot(Mcap.Rdark.aov$fitted.values, Mcap.Rdark.aov$residuals)
shapiro.test(Mcap.Rdark.aov$residuals) 
```



